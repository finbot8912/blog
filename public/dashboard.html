<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedAlo Blog - ì‚¬ìš© í˜„í™© ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* ë¡œê·¸ì¸ í™”ë©´ ìŠ¤íƒ€ì¼ */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .login-title {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-align: center;
        }

        .login-subtitle {
            color: #a1a1aa;
            text-align: center;
            margin-bottom: 30px;
        }

        .login-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            color: #e4e4e7;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .login-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-button {
            width: 100%;
            padding: 12px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-button:hover {
            background: linear-gradient(135deg, #5568d3 0%, #63408b 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .login-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: #fca5a5;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            display: none;
        }

        .hidden {
            display: none !important;
        }
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e4e4e7;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #a1a1aa;
            font-size: 1.1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
        }

        .stat-label {
            font-size: 0.9rem;
            color: #a1a1aa;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #fff;
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .controls {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .controls-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #d4d4d8;
        }

        select, button, .date-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            color: #e4e4e7;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select:hover, button:hover, .date-input:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
        }

        .date-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .user-checkbox-wrapper {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .user-checkbox-wrapper:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateY(-2px);
        }

        .user-checkbox-wrapper.active {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 1);
        }

        .user-checkbox {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .user-label {
            color: #e4e4e7;
            font-weight: 500;
            font-size: 0.95rem;
            cursor: pointer;
        }

        .user-checkbox-wrapper.active .user-label {
            color: #fff;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        button:hover {
            background: linear-gradient(135deg, #5568d3 0%, #63408b 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #fff;
        }

        .table-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            background: rgba(102, 126, 234, 0.2);
            font-weight: 600;
            color: #fff;
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #a1a1aa;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .controls-row {
                flex-direction: column;
            }

            .control-group {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <h2 class="login-title">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
            <p class="login-subtitle">ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ì„ ìœ„í•´ ë¡œê·¸ì¸í•˜ì„¸ìš”</p>
            
            <div id="loginError" class="login-error"></div>
            
            <form id="loginForm" onsubmit="handleLogin(event)">
                <input 
                    type="text" 
                    id="adminId" 
                    class="login-input" 
                    placeholder="ê´€ë¦¬ì ID"
                    required
                />
                <input 
                    type="password" 
                    id="adminPassword" 
                    class="login-input" 
                    placeholder="ë¹„ë°€ë²ˆí˜¸"
                    required
                />
                <button type="submit" class="login-button">ë¡œê·¸ì¸</button>
            </form>
        </div>
    </div>

    <!-- ë©”ì¸ ëŒ€ì‹œë³´ë“œ (ë¡œê·¸ì¸ í›„ í‘œì‹œ) -->
    <div id="dashboardContent" class="container hidden">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>ğŸ“Š ì‚¬ìš© í˜„í™© ëŒ€ì‹œë³´ë“œ</h1>
                    <p class="subtitle">MedAlo Blog ìƒì„±ê¸° ì‚¬ìš©ì í™œë™ ë¶„ì„</p>
                </div>
                <button onclick="logout()" style="width: auto; padding: 10px 20px; background: rgba(239, 68, 68, 0.8); border: 1px solid rgba(239, 68, 68, 1);">
                    ğŸšª ë¡œê·¸ì•„ì›ƒ
                </button>
            </div>
        </header>

        <!-- í†µê³„ ì¹´ë“œ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ‘¥</div>
                <div class="stat-label">ì´ ì‚¬ìš©ì ìˆ˜</div>
                <div class="stat-value" id="totalUsers">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ”</div>
                <div class="stat-label">ì´ ë¡œê·¸ì¸ íšŸìˆ˜</div>
                <div class="stat-value" id="totalLogins">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">â±ï¸</div>
                <div class="stat-label">ì´ ì‚¬ìš© ì‹œê°„</div>
                <div class="stat-value" id="totalDuration">0ë¶„</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ“ˆ</div>
                <div class="stat-label">í‰ê·  ì„¸ì…˜ ì‹œê°„</div>
                <div class="stat-value" id="avgDuration">0ë¶„</div>
            </div>
        </div>

        <!-- í•„í„° ì»¨íŠ¸ë¡¤ -->
        <div class="controls">
            <!-- ì‚¬ìš©ì í•„í„° ì„¹ì…˜ -->
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 12px; font-size: 1.1rem; font-weight: 600; color: #fff;">ğŸ‘¥ ì‚¬ìš©ì í•„í„°</label>
                <div id="userFilterContainer" style="display: flex; flex-wrap: wrap; gap: 12px; padding: 15px; background: rgba(255, 255, 255, 0.03); border-radius: 8px;">
                    <!-- ì‚¬ìš©ì ì²´í¬ë°•ìŠ¤ê°€ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ë‚ ì§œ ë²”ìœ„ ë° ì»¨íŠ¸ë¡¤ -->
            <div class="controls-row">
                <div class="control-group">
                    <label for="startDate">ğŸ“… ì‹œì‘ ë‚ ì§œ</label>
                    <input type="date" id="startDate" class="date-input" />
                </div>
                <div class="control-group">
                    <label for="endDate">ğŸ“… ì¢…ë£Œ ë‚ ì§œ</label>
                    <input type="date" id="endDate" class="date-input" />
                </div>
                <div class="control-group">
                    <label for="viewType">ğŸ“Š í†µê³„ ìœ í˜•</label>
                    <select id="viewType">
                        <option value="daily">ì¼ë³„</option>
                        <option value="weekly">ì£¼ë³„</option>
                        <option value="monthly">ì›”ë³„</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>&nbsp;</label>
                    <button onclick="resetFilters()">ğŸ”„ í•„í„° ì´ˆê¸°í™”</button>
                </div>
            </div>
            
            <!-- ë°ì´í„° ê´€ë¦¬ ë²„íŠ¼ -->
            <div class="controls-row" style="margin-top: 15px;">
                <div class="control-group">
                    <button onclick="exportData()">ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
                </div>
                <div class="control-group">
                    <button onclick="clearData()">ğŸ—‘ï¸ ë°ì´í„° ì‚­ì œ</button>
                </div>
            </div>
        </div>

        <!-- ì°¨íŠ¸ -->
        <div class="charts-grid">
            <div class="chart-container">
                <h3 class="chart-title">ğŸ“Š ë¡œê·¸ì¸ íšŸìˆ˜</h3>
                <canvas id="loginChart"></canvas>
            </div>
            <div class="chart-container">
                <h3 class="chart-title">â±ï¸ ì‚¬ìš© ì‹œê°„</h3>
                <canvas id="durationChart"></canvas>
            </div>
        </div>

        <!-- ìƒì„¸ ë°ì´í„° í…Œì´ë¸” -->
        <div class="table-container">
            <h3 class="chart-title">ğŸ“‹ ìƒì„¸ ë¡œê·¸ ê¸°ë¡</h3>
            <div id="logsTable"></div>
        </div>
    </div>

    <script>
        // ê´€ë¦¬ì ì¸ì¦ ì •ë³´
        const ADMIN_CREDENTIALS = {
            id: 'admin',
            password: 'myst2204@@'
        };

        // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        function checkAuth() {
            const isAuthenticated = sessionStorage.getItem('dashboard_auth');
            if (isAuthenticated === 'true') {
                showDashboard();
            }
        }

        // ë¡œê·¸ì¸ ì²˜ë¦¬
        function handleLogin(event) {
            event.preventDefault();
            
            const adminId = document.getElementById('adminId').value;
            const adminPassword = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('loginError');
            
            if (adminId === ADMIN_CREDENTIALS.id && adminPassword === ADMIN_CREDENTIALS.password) {
                // ë¡œê·¸ì¸ ì„±ê³µ
                sessionStorage.setItem('dashboard_auth', 'true');
                showDashboard();
            } else {
                // ë¡œê·¸ì¸ ì‹¤íŒ¨
                errorDiv.textContent = 'âŒ ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                errorDiv.style.display = 'block';
                
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
            }
        }

        // ëŒ€ì‹œë³´ë“œ í‘œì‹œ
        function showDashboard() {
            document.getElementById('loginOverlay').classList.add('hidden');
            document.getElementById('dashboardContent').classList.remove('hidden');
            updateDashboard();
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                sessionStorage.removeItem('dashboard_auth');
                location.reload();
            }
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function getAllLogs() {
            try {
                const data = localStorage.getItem('medalo_usage_logs');
                return data ? JSON.parse(data) : [];
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                return [];
            }
        }

        // ë°€ë¦¬ì´ˆë¥¼ ì‹œê°„ ë¬¸ìì—´ë¡œ ë³€í™˜
        function formatDuration(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);

            if (hours > 0) {
                return `${hours}ì‹œê°„ ${minutes % 60}ë¶„`;
            } else if (minutes > 0) {
                return `${minutes}ë¶„`;
            } else {
                return `${seconds}ì´ˆ`;
            }
        }

        // í†µê³„ ì¹´ë“œ ì—…ë°ì´íŠ¸
        function updateStatsCards(logs) {
            const uniqueUsers = new Set(logs.map(log => log.userId)).size;
            const totalLogins = logs.length;
            const totalDuration = logs.reduce((sum, log) => sum + log.duration, 0);
            const avgDuration = totalLogins > 0 ? totalDuration / totalLogins : 0;

            document.getElementById('totalUsers').textContent = uniqueUsers;
            document.getElementById('totalLogins').textContent = totalLogins;
            document.getElementById('totalDuration').textContent = formatDuration(totalDuration);
            document.getElementById('avgDuration').textContent = formatDuration(avgDuration);
        }

        // ì„ íƒëœ ì‚¬ìš©ì ëª©ë¡ (ë¹ˆ ë°°ì—´ = ì „ì²´ ì‚¬ìš©ì)
        let selectedUsers = [];

        // ì‚¬ìš©ì ì²´í¬ë°•ìŠ¤ ìƒì„±
        function createUserCheckboxes(logs) {
            const uniqueUsers = [...new Set(logs.map(log => log.userId))].sort();
            const container = document.getElementById('userFilterContainer');
            
            // ê¸°ì¡´ ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
            container.innerHTML = '';
            
            uniqueUsers.forEach(userId => {
                const wrapper = document.createElement('div');
                wrapper.className = 'user-checkbox-wrapper';
                wrapper.id = `user-wrapper-${userId}`;
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `user-${userId}`;
                checkbox.className = 'user-checkbox';
                checkbox.value = userId;
                checkbox.checked = selectedUsers.length === 0 || selectedUsers.includes(userId);
                
                const label = document.createElement('label');
                label.htmlFor = `user-${userId}`;
                label.className = 'user-label';
                label.textContent = userId;
                
                // ì²´í¬ë°•ìŠ¤ ë³€ê²½ ì´ë²¤íŠ¸
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        if (!selectedUsers.includes(userId)) {
                            selectedUsers.push(userId);
                        }
                        wrapper.classList.add('active');
                    } else {
                        selectedUsers = selectedUsers.filter(id => id !== userId);
                        wrapper.classList.remove('active');
                    }
                    updateDashboard();
                });
                
                // ë˜í¼ í´ë¦­ ì‹œ ì²´í¬ë°•ìŠ¤ í† ê¸€
                wrapper.addEventListener('click', function(e) {
                    if (e.target !== checkbox) {
                        checkbox.checked = !checkbox.checked;
                        checkbox.dispatchEvent(new Event('change'));
                    }
                });
                
                // ì´ˆê¸° í™œì„± ìƒíƒœ ì„¤ì •
                if (checkbox.checked) {
                    wrapper.classList.add('active');
                }
                
                wrapper.appendChild(checkbox);
                wrapper.appendChild(label);
                container.appendChild(wrapper);
            });
        }

        // ë‚ ì§œ ì´ˆê¸°í™” (ì˜¤ëŠ˜ ê¸°ì¤€ ìµœê·¼ 30ì¼)
        function initializeDates() {
            const today = new Date();
            const thirtyDaysAgo = new Date(today);
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            
            if (!startDateInput.value) {
                startDateInput.value = thirtyDaysAgo.toISOString().split('T')[0];
            }
            if (!endDateInput.value) {
                endDateInput.value = today.toISOString().split('T')[0];
            }
        }

        // í•„í„° ì´ˆê¸°í™”
        function resetFilters() {
            selectedUsers = [];
            
            // ëª¨ë“  ì²´í¬ë°•ìŠ¤ ì²´í¬
            const checkboxes = document.querySelectorAll('.user-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = true;
                document.getElementById(`user-wrapper-${cb.value}`).classList.add('active');
            });
            
            // ë‚ ì§œ ì´ˆê¸°í™”
            const today = new Date();
            const thirtyDaysAgo = new Date(today);
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            document.getElementById('startDate').value = thirtyDaysAgo.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            document.getElementById('viewType').value = 'daily';
            
            updateDashboard();
        }

        // ì°¨íŠ¸ ë³€ìˆ˜
        let loginChart, durationChart;

        // ì°¨íŠ¸ ì œëª© ì—…ë°ì´íŠ¸
        function updateChartTitles(viewType) {
            const viewTypeNames = {
                'daily': 'ì¼ë³„',
                'weekly': 'ì£¼ë³„',
                'monthly': 'ì›”ë³„'
            };
            
            const loginTitle = document.querySelector('#loginChart').parentElement.querySelector('.chart-title');
            const durationTitle = document.querySelector('#durationChart').parentElement.querySelector('.chart-title');
            
            loginTitle.textContent = `ğŸ“Š ë¡œê·¸ì¸ íšŸìˆ˜ (${viewTypeNames[viewType]})`;
            durationTitle.textContent = `â±ï¸ ì‚¬ìš© ì‹œê°„ (${viewTypeNames[viewType]})`;
        }

        // ë ˆì´ë¸” í¬ë§·íŒ…
        function formatLabel(key, viewType) {
            if (viewType === 'daily') {
                // 2025-11-15 â†’ 11/15 (ê¸ˆ)
                const date = new Date(key);
                const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                return `${date.getMonth() + 1}/${date.getDate()} (${dayNames[date.getDay()]})`;
            } else if (viewType === 'weekly') {
                // 2025-11-11 â†’ 11/11 ì£¼
                const date = new Date(key);
                return `${date.getMonth() + 1}/${date.getDate()} ì£¼`;
            } else if (viewType === 'monthly') {
                // 2025-11 â†’ 2025ë…„ 11ì›”
                const [year, month] = key.split('-');
                return `${year}ë…„ ${month}ì›”`;
            }
            return key;
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateCharts(logs, viewType) {
            const stats = getStats(logs, viewType);
            
            // ì°¨íŠ¸ ì œëª© ì—…ë°ì´íŠ¸
            updateChartTitles(viewType);
            
            // ë ˆì´ë¸” í¬ë§·íŒ…
            const formattedLabels = stats.labels.map(label => formatLabel(label, viewType));
            
            // ê¸°ì¡´ ì°¨íŠ¸ íŒŒê´´
            if (loginChart) loginChart.destroy();
            if (durationChart) durationChart.destroy();

            // ë¡œê·¸ì¸ íšŸìˆ˜ ì°¨íŠ¸
            const loginCtx = document.getElementById('loginChart').getContext('2d');
            loginChart = new Chart(loginCtx, {
                type: 'bar',
                data: {
                    labels: formattedLabels,
                    datasets: [{
                        label: 'ë¡œê·¸ì¸ íšŸìˆ˜',
                        data: stats.counts,
                        backgroundColor: 'rgba(102, 126, 234, 0.7)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        borderRadius: 8,
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { 
                            display: true,
                            labels: { color: '#e4e4e7' }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return stats.labels[context[0].dataIndex];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                color: '#a1a1aa',
                                stepSize: 1
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { 
                                color: '#a1a1aa',
                                maxRotation: 45,
                                minRotation: 45
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });

            // ì‚¬ìš© ì‹œê°„ ì°¨íŠ¸
            const durationCtx = document.getElementById('durationChart').getContext('2d');
            durationChart = new Chart(durationCtx, {
                type: 'line',
                data: {
                    labels: formattedLabels,
                    datasets: [{
                        label: 'ì‚¬ìš© ì‹œê°„ (ë¶„)',
                        data: stats.durations,
                        backgroundColor: 'rgba(118, 75, 162, 0.2)',
                        borderColor: 'rgba(118, 75, 162, 1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointBackgroundColor: 'rgba(118, 75, 162, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 7,
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { 
                            display: true,
                            labels: { color: '#e4e4e7' }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return stats.labels[context[0].dataIndex];
                                },
                                label: function(context) {
                                    return `ì‚¬ìš© ì‹œê°„: ${context.parsed.y}ë¶„`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                color: '#a1a1aa',
                                callback: function(value) {
                                    return value + 'ë¶„';
                                }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        x: {
                            ticks: { 
                                color: '#a1a1aa',
                                maxRotation: 45,
                                minRotation: 45
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        // í†µê³„ ë°ì´í„° ê³„ì‚°
        function getStats(logs, viewType) {
            const statsMap = {};

            logs.forEach(log => {
                let key;
                if (viewType === 'daily') {
                    key = log.date;
                } else if (viewType === 'weekly') {
                    key = getWeekKey(new Date(log.date));
                } else if (viewType === 'monthly') {
                    key = log.date.substring(0, 7); // YYYY-MM
                }

                if (!statsMap[key]) {
                    statsMap[key] = { count: 0, totalDuration: 0 };
                }
                statsMap[key].count++;
                statsMap[key].totalDuration += log.duration;
            });

            const sortedKeys = Object.keys(statsMap).sort();
            return {
                labels: sortedKeys,
                counts: sortedKeys.map(key => statsMap[key].count),
                durations: sortedKeys.map(key => Math.round(statsMap[key].totalDuration / 60000)) // ë¶„ ë‹¨ìœ„
            };
        }

        // ì£¼ ì‹œì‘ì¼ ê³„ì‚°
        function getWeekKey(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1);
            const weekStart = new Date(d.setDate(diff));
            return weekStart.toISOString().split('T')[0];
        }

        // ë¡œê·¸ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateLogsTable(logs) {
            const container = document.getElementById('logsTable');
            
            if (logs.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“­</div>
                        <h3>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ì•„ì§ ê¸°ë¡ëœ ì‚¬ìš© ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            const sortedLogs = [...logs].reverse(); // ìµœì‹ ìˆœ

            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>ì‚¬ìš©ì ID</th>
                            <th>ë‚ ì§œ</th>
                            <th>ë¡œê·¸ì¸ ì‹œê°„</th>
                            <th>ë¡œê·¸ì•„ì›ƒ ì‹œê°„</th>
                            <th>ì‚¬ìš© ì‹œê°„</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sortedLogs.map(log => `
                            <tr>
                                <td>${log.userId}</td>
                                <td>${log.date}</td>
                                <td>${new Date(log.loginTime).toLocaleTimeString('ko-KR')}</td>
                                <td>${log.logoutTime ? new Date(log.logoutTime).toLocaleTimeString('ko-KR') : 'ì§„í–‰ì¤‘'}</td>
                                <td>${formatDuration(log.duration)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHtml;
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportData() {
            const logs = getAllLogs();
            const dataStr = JSON.stringify(logs, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `medalo_usage_logs_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        // ë°ì´í„° ì‚­ì œ
        function clearData() {
            if (confirm('ëª¨ë“  ì‚¬ìš© ì´ë ¥ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.removeItem('medalo_usage_logs');
                location.reload();
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        function updateDashboard() {
            const viewType = document.getElementById('viewType').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            let logs = getAllLogs();
            
            // ì‚¬ìš©ì ì²´í¬ë°•ìŠ¤ ìƒì„± (ìµœì´ˆ 1íšŒë§Œ)
            if (document.getElementById('userFilterContainer').children.length === 0) {
                createUserCheckboxes(logs);
            }
            
            // ë‚ ì§œ ë²”ìœ„ í•„í„° ì ìš©
            if (startDate && endDate) {
                logs = logs.filter(log => {
                    return log.date >= startDate && log.date <= endDate;
                });
            }
            
            // ì‚¬ìš©ì í•„í„° ì ìš©
            if (selectedUsers.length > 0) {
                logs = logs.filter(log => selectedUsers.includes(log.userId));
            }

            updateStatsCards(logs);
            updateCharts(logs, viewType);
            updateLogsTable(logs);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('viewType').addEventListener('change', updateDashboard);
        document.getElementById('startDate').addEventListener('change', updateDashboard);
        document.getElementById('endDate').addEventListener('change', updateDashboard);

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ í™•ì¸
        checkAuth();

        // ë‚ ì§œ ì´ˆê¸°í™”
        initializeDates();

        // 5ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨ (ë¡œê·¸ì¸ í›„)
        setInterval(() => {
            if (sessionStorage.getItem('dashboard_auth') === 'true') {
                updateDashboard();
            }
        }, 5000);
    </script>
</body>
</html>

